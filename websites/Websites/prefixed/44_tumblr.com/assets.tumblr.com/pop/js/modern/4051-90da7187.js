"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[4051],{64051:(e,t,s)=>{s.d(t,{Z:()=>I,c:()=>C});var r=s(50209),n=s.n(r),i=s(29774),o=s(95004),h=s(63665),l=s(60023),a=s(18599),c=s(53739),u=s(58546),p=s(86033),g=s(5754),d=s.n(g),f=s(3732),R=s(96467);const P={pullToRefresh:"gxf2Y",refreshing:"bZWbL",wipe:"b4eLl",changeColor:"d8uWm",innerCircle:"sRM0W",outerCircle:"v2cZ4"};var v=s(2629);const m=e=>{const{isRefreshing:t,pullingProgress:s=0}=e;let r;if(!t){const e=Math.min(1,Math.max(s,0)),t=Math.pow(e,4);r={strokeDashoffset:R.pullToRefreshCircumferencePx*(1-t)}}return(0,v.jsx)(f.SL,{children:e=>{const s=e?e.linkColor:void 0;return(0,v.jsx)("div",{className:d()(P.pullToRefresh,t?P.refreshing:P.pulling),children:(0,v.jsx)("svg",{viewBox:`0 0 ${R.pullToRefreshHeightPx} ${R.pullToRefreshHeightPx}`,height:`${R.pullToRefreshHeightPx}px`,width:`${R.pullToRefreshHeightPx}px`,children:(0,v.jsx)("circle",{stroke:s,cx:R.pullToRefreshHeightPx/2,cy:R.pullToRefreshHeightPx/2,r:R.pullToRefreshHeightPx/2-R.pullToRefreshPaddingPx,style:r})})})}})};m.defaultProps={};const x=m;var b=s(94576);let T;!function(e){e[e.PullingToRefresh=0]="PullingToRefresh",e[e.RefreshingResults=1]="RefreshingResults",e[e.RefreshedResults=2]="RefreshedResults"}(T||(T={}));class S extends o.Component{constructor(){super(...arguments),n()(this,"state",{refreshingState:T.PullingToRefresh,gestureStart:0,gestureDistance:0}),n()(this,"canPullToRefresh",(()=>(this.props.scrollContainer!==(0,c.Z)()?this.props.scrollContainer.scrollTop:b.ZP.getInfo().scrollY)<=0&&this.state.refreshingState!==T.RefreshingResults)),n()(this,"touchStart",(e=>{e.stopPropagation(),this.canPullToRefresh()&&this.setState({gestureStart:e.touches[0].screenY,gestureDistance:0,refreshingState:T.PullingToRefresh})})),n()(this,"touchMove",(e=>{if(e.stopPropagation(),!this.canPullToRefresh())return Promise.resolve();const t=(e.touches[0].screenY-this.state.gestureStart)/2,s=t>50?T.RefreshingResults:T.PullingToRefresh;return new Promise((e=>{this.state.refreshingState!==T.RefreshedResults&&s===T.RefreshingResults?this.setState({refreshingState:s,gestureDistance:t},(()=>{this.props.refresh().then((()=>this.setState({refreshingState:T.RefreshedResults},e)))})):this.setState({gestureDistance:t},e)}))})),n()(this,"touchEnd",(e=>{e.stopPropagation(),this.setState({gestureStart:0,gestureDistance:0})})),n()(this,"attachHandlers",(e=>{e&&(e.addEventListener("touchstart",this.touchStart),e.addEventListener("touchmove",this.touchMove),e.addEventListener("touchend",this.touchEnd))})),n()(this,"removeHandlers",(e=>{e&&(e.removeEventListener("touchstart",this.touchStart),e.removeEventListener("touchmove",this.touchMove),e.removeEventListener("touchend",this.touchEnd))}))}componentDidUpdate(e){const{scrollContainer:t}=this.props,{scrollContainer:s}=e;!t&&s&&this.attachHandlers(s),t&&!s&&this.removeHandlers(t),t&&s&&t!==s&&(this.removeHandlers(t),this.attachHandlers(s))}componentDidMount(){this.attachHandlers(this.props.scrollContainer)}componentWillUnmount(){this.removeHandlers(this.props.scrollContainer)}render(){let e;switch(this.state.refreshingState){case T.RefreshingResults:e={isRefreshing:!0};break;case T.PullingToRefresh:e={pullingProgress:this.state.gestureDistance/50};case T.RefreshedResults:}let t=0;switch(this.state.refreshingState){case T.PullingToRefresh:t=this.state.gestureDistance;break;case T.RefreshedResults:t=0;break;case T.RefreshingResults:t=50}return(0,v.jsx)("div",{style:{height:t,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,v.jsx)(x,{...e})})}}const C={direction:h.cU.Bottom,lockScrollOnObjectUpdate:!1,getNextLink:e=>{var t,s;return null==e||null===(t=e.response)||void 0===t||null===(s=t.links)||void 0===s?void 0:s.next}};class I extends o.Component{constructor(){var e;super(...arguments),e=this,n()(this,"state",(()=>{const{getInitialPage:e}=this.props,t=null==e?void 0:e(),s=null==t?void 0:t.objects,r=null==t?void 0:t.nextLink;return{...this.getEmptyInitialState(),hasFetchedInitialPage:!!s,objects:s||[],nextLink:r}})()),n()(this,"getObjectsToRender",(0,i.Z)(((e,t)=>(null==t?void 0:t.filter((t=>!(null!=e&&e(t)))))||[]))),n()(this,"scrollToTop",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";const s=e.getScrollableContainer();null!=s&&s.scrollTo&&s.scrollTo({behavior:t,top:0,left:0})})),n()(this,"scrollToBottom",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";const{scrollContainer:s}=e.props,r=e.getScrollableContainer();null!=r&&r.scrollTo&&r.scrollTo({behavior:t,top:((0,h.Re)(s)?s:document.body).scrollHeight,left:0})})),n()(this,"shouldRenderMainLoader",(()=>!this.state.hasFetchedInitialPage)),n()(this,"fetchNextPage",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.state.nextLink;var s,r;return e.canFetchNextPage(t)?(null===(s=(r=e.props).onFetchNextPage)||void 0===s||s.call(r),e.handleContentFetch({fetchPromise:e.getFetchNextPageRequest(t).fetch(),requestType:h.vO.Pagination,fetchingState:{loadingNextPage:!0},fetchedState:{loadingNextPage:!1},getObjectsFromResponse:e.addObjectsToExisting})):Promise.resolve()})),n()(this,"canFetchNextPage",(e=>{const{loadingNextPage:t,refreshingPage:s,apiRequestFailed:r}=this.state;return!(r&&Date.now()-r<2e3)&&(!t&&!s&&!!e)})),n()(this,"refresh",(()=>{const{endpointApiRequest:e,direction:t}=this.props;return this.state.refreshingPage?Promise.resolve():(t===h.cU.Bottom&&this.scrollToTop(),e?this.handleContentFetch({fetchPromise:e.fetch(),requestType:h.vO.Refresh,fetchingState:{refreshingPage:!0},fetchedState:{refreshingPage:!1,loadingNextPage:!1}}):Promise.resolve())})),n()(this,"endpointApiRequestAvailable",(e=>!!e)),n()(this,"fetchInitialPage",(()=>this.endpointApiRequestAvailable(this.props.endpointApiRequest)?this.handleContentFetch({fetchPromise:this.props.endpointApiRequest.fetch(),requestType:h.vO.Initial,fetchingState:{objects:[],loadingNextPage:!0},fetchedState:{hasFetchedInitialPage:!0,loadingNextPage:!1}}):Promise.resolve())),n()(this,"transformObjects",(e=>{const t=window.scrollY;this.setState((t=>({objects:e(t.objects)})),(()=>{this.props.lockScrollOnObjectUpdate&&window.scrollTo({top:t})}))})),n()(this,"cancelInProgressFetchIfNecessary",(()=>{this.fetchInProgress&&(this.fetchInProgress.cancel(),this.fetchInProgress=null)})),n()(this,"getScrollableContainer",(()=>this.props.scrollContainer||window))}componentDidMount(){return this.props.imperativeRefreshReference&&(this.props.imperativeRefreshReference.current=()=>this.refresh()),this.state.hasFetchedInitialPage?Promise.resolve():this.fetchInitialPage()}componentWillUnmount(){this.cancelInProgressFetchIfNecessary()}componentDidUpdate(e){this.didChangeEndpoint(e)&&(this.cancelInProgressFetchIfNecessary(),this.setState(this.getEmptyInitialState(),(()=>this.fetchInitialPage())))}render(){const{initialLoader:e,loader:t,scrollContainer:s=(0,c.Z)(),emptyView:r,errorView:n,pullToRefresh:i,debug:o,isObjectOmittedFromRender:l,direction:a}=this.props,{objects:p,apiRequestFailed:g}=this.state,d=this.getObjectsToRender(l,p),f=this.props.children,R=a===h.cU.Top,P=this.shouldRenderMainLoader()?e||t:g?n:(0,u.y)(d)&&r;return(0,v.jsxs)(v.Fragment,{children:[i&&(0,v.jsx)(S,{refresh:this.refresh,scrollContainer:s,debug:o}),R&&P,null==f?void 0:f({objects:d,refresh:this.refresh,transformObjects:this.transformObjects}),!R&&P]})}getEmptyInitialState(){return{objects:[],hasFetchedInitialPage:!1,refreshingPage:!1,loadingNextPage:!1,apiRequestFailed:!1,nextLink:null}}didChangeEndpoint(e){const{endpointApiRequest:t}=this.props;return e.endpointApiRequest?!e.endpointApiRequest.isEqualTo(t):!!t}onPagination(e){var t,s;null===(t=(s=this.props).onPagination)||void 0===t||t.call(s,e)}getFetchNextPageRequest(e){return new l.x(this.props.appContext.apiFetch,null==e?void 0:e.href)}handleContentFetch(e){let{fetchPromise:t,requestType:s,fetchingState:r,fetchedState:n,getObjectsFromResponse:i=this.props.getObjectsFromResponse}=e;this.cancelInProgressFetchIfNecessary(),this.preHandleContentFetch(s);const{getNextLink:o,scrollContainer:l=(0,c.Z)(),direction:u,appContext:{getBrowserInfo:g}}=this.props;return new Promise((e=>{this.setState({...r},(()=>{this.fetchInProgress=(0,p.Z)(t),this.fetchInProgress.then((t=>{const r=(0,a.wQ)(g())&&u===h.cU.Top&&s!==h.vO.Initial&&!!l,c=r&&(0,h.Re)(l)&&l.getAttribute("style")||h.rF;r&&(0,h.Re)(l)&&l.setAttribute("style",`${c}; overflow-y: hidden`);const p=i(t),d=null==o?void 0:o(t);this.onPagination({objects:p,nextLink:d,response:t,requestType:s}),this.setState({...n,objects:p,nextLink:d},(()=>{this.fetchInProgress=null,r&&(0,h.Re)(l)&&l.setAttribute("style",c),e()}))})).catch((t=>{const{onPaginationError:r}=this.props;this.setState({...n,apiRequestFailed:Date.now()},(()=>{r&&r({error:t,requestType:s}),e()}))}))}))}))}}n()(I,"defaultProps",C)},63665:(e,t,s)=>{s.d(t,{Re:()=>h,cU:()=>i,rF:()=>o,vO:()=>n});var r=s(53739);let n,i;!function(e){e[e.Initial=0]="Initial",e[e.Pagination=1]="Pagination",e[e.Refresh=2]="Refresh"}(n||(n={})),function(e){e.Bottom="bottom",e.Top="top",e.Right="right"}(i||(i={}));const o="";function h(e){return!!e&&e!==(0,r.Z)()}},53739:(e,t,s)=>{s.d(t,{Z:()=>r});const r=()=>window}}]);