"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[5379],{60385:(e,t,s)=>{s.d(t,{Z:()=>n});const n={timeline:"j8ha0",isSorting:"avWLs",masonry:"qr36f",gridded:"RlWaM",loader:"IKfVk",noContent:"cRPdZ",masonryEmptyView:"GWJvH",manualPaginatorButtonsGrid:"Tj4be",restoreTimelineText:"rqHFc",animateOut:"x7_ZU",animateIn:"O5WoU",animateContainerIn:"E4obd",none:"ZRX9S"}},67615:(e,t,s)=>{s.d(t,{Z:()=>n});const n=(0,s(95004).lazy)((()=>s.e(9717).then(s.t.bind(s,94497,23))))},29583:(e,t,s)=>{s.d(t,{ZA:()=>g,ZP:()=>P,j0:()=>f});var n=s(50209),o=s.n(n),i=s(95004),r=s(235),a=s(5700),l=s(81584),d=s(59215),h=s(66591),c=s(96467),u=s.n(c),p=s(6790),m=s(2629);let g;!function(e){e.Next="next",e.Previous="previous"}(g||(g={}));const b={canFastQueue:!1,canFastReblog:!1,canFastQuote:!1},f=-(u().desktopHeaderHeightPx+u().marginBetweenPosts);class x extends i.Component{constructor(e){super(e),o()(this,"apiHelper",(0,l.ZP)(this.props.appContext.apiFetch)),o()(this,"blogs",[]),o()(this,"getBlogs",(()=>this.blogs)),o()(this,"setDefaultFastBlog",(e=>{this.blogs.sort(((t,s)=>s.name===e.name?1:t.name===e.name?-1:0))})),o()(this,"renderScrollPositionDependentHotkeys",(()=>(0,m.jsx)(p.ZP,{hotkey:[{key:p.SV.J,command:this.scrollToNextElement},{key:p.SV.K,command:this.scrollToPreviousElement},{key:p.SV.L,command:this.likeVisibleTimelineObject},{key:p.SV.R,command:this.reblogVisibleTimelineObject,modifiers:{[p.TE.Alt]:!0}}]}))),o()(this,"enableFastReblog",(()=>!this.state.canFastReblog&&this.setState({canFastReblog:!0}))),o()(this,"disableFastReblog",(()=>this.state.canFastReblog&&this.setState({canFastReblog:!1}))),o()(this,"enableFastQueue",(()=>!this.state.canFastQueue&&this.setState({canFastQueue:!0}))),o()(this,"disableFastQueue",(()=>this.state.canFastQueue&&this.setState({canFastQueue:!1}))),o()(this,"enableFastQuote",(()=>!this.state.canFastQuote&&this.setState({canFastQuote:!0}))),o()(this,"disableFastQuote",(()=>this.state.canFastQuote&&this.setState({canFastQuote:!1}))),o()(this,"isValidElement",(e=>!(null==e||!e.ref))),o()(this,"scrollToNextElement",(()=>{this.scrollToElement(g.Next)})),o()(this,"scrollToPreviousElement",(()=>{this.scrollToElement(g.Previous)})),o()(this,"scrollToElement",(e=>{if(this.props.scrollToElement)return this.props.scrollToElement(e);const{scrollContainerContext:t,getPostRefs:s,appContext:{isModalShowing:n},dashboardContext:{preventTabbedDashboardAppearOnNextScroll:o}}=this.props,i=t||document.documentElement,r=[...s()];e===g.Previous&&(r.reverse(),null==o||o());const a=Math.ceil(i.scrollTop);for(const t of r)if(this.isValidElement(t)){const s=t.ref,o=void 0!==(null==(l=s.offsetParent)?void 0:l.offsetTop)?s.offsetParent.offsetTop:0,r=s.offsetTop+o,d=a-r,h=n?-u().marginBetweenPosts:f;if(e===g.Next?d<h:d>h)return s.focus({preventScroll:!0}),void i.scrollTo({left:0,top:r+h})}var l;if(e===g.Next){const e=t?t.scrollHeight:document.body.scrollHeight;i.scrollTo({left:0,top:e})}})),o()(this,"scrollToTop",(()=>{if(this.props.scrollToTop)return this.props.scrollToTop();(this.props.scrollContainerContext||document.documentElement).scrollTo({behavior:"smooth",left:0,top:0})})),o()(this,"likeVisibleTimelineObject",(()=>{const e=this.getVisibleTimelineObject(),{liked:t,id:s,reblogKey:n,blogName:o,placementId:i,earnedId:r}=e.props.timelineObject,{timelineContext:{onLike:a},appContext:{logEvent:l}}=this.props;return this.apiHelper.likePost({id:s,liked:t,reblogKey:n,blogName:o,placementId:i,earnedId:r,logEvent:l,onLike:a}).fetch().catch((e=>{const{toggleToast:t}=this.props.toastContext;e instanceof h.Z&&t(e.message,"error")}))})),o()(this,"reblogVisibleTimelineObject",(()=>this.postVisibleTimelineObject(a.hA.Published,this.props.appContext._t("Reblogged!")))),o()(this,"queueVisibleTimelineObject",(()=>this.postVisibleTimelineObject(a.hA.Queue,this.props.appContext._t("Queued!")))),o()(this,"postVisibleTimelineObject",((e,t)=>{const s=this.getVisibleTimelineObject().props.timelineObject.placementId,{appContext:{getUserInfo:n,_c:o,logEvent:i},toastContext:{toggleToast:r}}=this.props,a=this.getVisibleTimelineObject().props.timelineObject;return n().then((n=>{let{name:o}=n;const{blog:l,id:d,reblogKey:h,earnedId:c}=a;return this.apiHelper.postAPost({selectedBlogName:o,placementId:s,logEvent:i,post:{reblogKey:h,earnedId:c,content:[],state:e,parentTumblelogUuid:l.name,parentPostId:d,id:void 0}}).fetch((()=>(this.setState({fastRebloggedPosts:this.state.fastRebloggedPosts.concat([a.id])}),r(t))))})).catch((()=>r(o("Failed to do action","Failed"))))})),o()(this,"getVisibleTimelineObject",(()=>{const{scrollContainerContext:e}=this.props,t=this.props.getPostRefs(),s=Math.ceil((e||document.documentElement).scrollTop);for(const o of t)if(this.isValidElement(o)){var n;const t=o.ref;if(s-(e?t.offsetTop+((null===(n=t.offsetParent)||void 0===n?void 0:n.offsetTop)||0):t.offsetTop)<t.clientHeight+f)return o}})),o()(this,"unsetCanFastAction",(()=>this.setState(b))),this.state={canFastReblog:!1,canFastQueue:!1,canFastQuote:!1,fastRebloggedPosts:[],setDefaultFastBlog:this.setDefaultFastBlog,getBlogs:this.getBlogs}}componentDidMount(){return window.addEventListener("blur",this.unsetCanFastAction),this.props.appContext.getUserInfo().then((e=>{let{blogs:t=[]}=e;this.blogs=[...t]}))}componentWillUnmount(){window.removeEventListener("blur",this.unsetCanFastAction)}render(){const{disabled:e,children:t}=this.props,{canFastReblog:s,canFastQueue:n,canFastQuote:o,altPressed:i}=this.state;return(0,m.jsxs)(m.Fragment,{children:[!e&&this.renderScrollPositionDependentHotkeys(),s&&(0,m.jsx)(p.ZP,{hotkey:{key:p.SV.E,command:this.disableFastReblog,firesOnKeyUp:!0}}),n&&(0,m.jsx)(p.ZP,{hotkey:{key:p.SV.W,command:this.disableFastQueue,firesOnKeyUp:!0}}),o&&(0,m.jsx)(p.ZP,{hotkey:{key:p.SV.Q,command:this.disableFastQuote,firesOnKeyUp:!0}}),!e&&i&&(0,m.jsx)(p.ZP,{hotkey:[{key:p.SV.Q,command:this.queueVisibleTimelineObject,modifiers:{[p.TE.Alt]:!0}},{key:p.SV.Alt,command:()=>this.setState({altPressed:!1}),firesOnKeyUp:!0}]}),!e&&!i&&(0,m.jsx)(p.ZP,{hotkey:[{key:p.SV.Q,command:this.enableFastQuote},{key:p.SV.Alt,command:()=>this.setState({altPressed:!0})}]}),(0,m.jsx)(p.ZP,{hotkey:[{key:p.SV.Dot,command:this.scrollToTop},{key:p.SV.E,command:this.enableFastReblog},{key:p.SV.W,command:this.enableFastQueue}]}),(0,m.jsx)(r.ZP.Provider,{value:this.state,children:t})]})}}const P=(0,d.X9)(x,{appContext:!0,dashboardContext:!0,toastContext:!0,timelineContext:!0,scrollContainerContext:!0})},3457:(e,t,s)=>{s.d(t,{ZP:()=>E});var n=s(50209),o=s.n(n),i=s(5754),r=s.n(i),a=s(95004),l=s(79615),d=s(6790),h=s(98384),c=s(10381),u=s(63665),p=s(59215),m=s(7070),g=s(63583),b=s.n(g),f=s(96467),x=s.n(f),P=s(64051);const v="m3lOJ",C="PY8Tb",T="B5txQ",j="jIdvc",y="Xp6EK";var k=s(2629);const S={width:13,height:13},R={href:"DON'T FETCH ME! OH GUY, PLEASE DON'T FETCH ME!"},N={prevNextLinks:[],linkForCurrentPage:R};class O extends P.Z{constructor(){super(...arguments),o()(this,"addObjectsToExisting",this.props.concatenate?e=>{const{objects:t}=this.state,{direction:s,getObjectsFromResponse:n}=this.props;return s===u.cU.Top?n(e).concat(t):t.concat(n(e))}:this.props.getObjectsFromResponse),o()(this,"shouldRenderMainLoader",(()=>{const{hasFetchedInitialPage:e,loadingNextPage:t}=this.state;return!e||t})),o()(this,"preHandleContentFetch",(e=>{const{updateUrlFromCurrentPageLink:t}=this.props,{linkForCurrentPage:s}=this.state;switch(e){case u.vO.Initial:return;case u.vO.Refresh:return void(null==t||t());case u.vO.Pagination:return void(null==t||t(null==s?void 0:s.href))}})),o()(this,"getHotkeyCommands",(()=>{const{prevNextLinks:e,nextLink:t}=this.state,s=[];return 0!==e.length&&s.push({key:d.SV.Left,command:this.onClickPrevious}),t&&s.push({key:d.SV.Right,command:this.onClickNext}),s})),o()(this,"renderPaginationButtons",(e=>{const{prevNextLinks:t,nextLink:s}=this.state,{prevButtonIsRefresh:n,manualPaginatorButtonCss:{containerClassName:o,prevButtonStyle:i,nextButtonStyle:c}={},appContext:{_c:u},nextButton:p,concatenate:m}=this.props,g=u("The label for a button to return to the previous page of results","Previous"),f=u("The label for a button to refresh the contents of a set of posts to show the newest content in it","Latest"),x=u("The label for a button to go to the next page of results","Next"),P=!!t.length,R=P?this.onClickPrevious:this.refresh,N=P?g:f,O=P?{color:b().paletteWhite,background:b().paletteTransparentWhite65}:{color:b().paletteTransparentWhite87,background:"transparent",border:`2px solid ${b().paletteTransparentWhite87}`},I=!m&&P||n,F=!!s;return I||F?(0,k.jsxs)("div",{ref:this.setButtonContainerRef,className:r()(v,o),children:[(0,k.jsx)(d.ZP,{hotkey:this.getHotkeyCommands()}),I&&(0,k.jsxs)(l.Z,{label:g,wrapperClassName:r()(C,j),wrapperStyle:{...O,...i},className:y,onClick:R,children:[(0,k.jsx)(h.sz,{size:S,colors:{primary:(null==i?void 0:i.color)||O.color||"currentcolor"}}),N]}),F&&(p?(0,a.cloneElement)(p,{label:x,onClick:this.onClickNext}):(0,k.jsxs)(l.Z,{label:x,wrapperClassName:r()(C,T),wrapperStyle:{color:b().paletteWhite,background:b().paletteAccent,...this.getNextButtonStyle(e)},className:y,onClick:this.onClickNext,children:[x,(0,k.jsx)(h.iL,{size:S,colors:{primary:c&&c.color||b().paletteWhite}})]}))]}):null})),o()(this,"onClickPrevious",(()=>{const{prevNextLinks:e,firstPageInfo:t,linkForCurrentPage:s}=this.state,{updateUrlFromCurrentPageLink:n}=this.props,o=e.pop();if(!this.canFetchNextPage(o))return Promise.resolve();if(o===R&&t){const{endpointApiRequest:e,objects:o}=t;return this.nextPageApiRequest=e,null==n||n(e.getSearchParams(),!0),this.setState({...N,objects:o,nextLink:s},this.scrollToBottom),Promise.resolve()}return this.scrollToTop(),new Promise((t=>{this.setState({prevNextLinks:e,objects:[],linkForCurrentPage:o},t)})).then((()=>this.fetchNextPage(o))).then((()=>this.scrollToBottom()))})),o()(this,"onClickNext",(()=>{const{prevNextLinks:e,linkForCurrentPage:t,nextLink:s,objects:n}=this.state,{endpointApiRequest:o,concatenate:i}=this.props;return this.canFetchNextPage(s)&&o?(i||this.scrollToTop(),new Promise((r=>{this.setState({objects:i?this.state.objects:[],prevNextLinks:[...e,t],linkForCurrentPage:s,...t===R&&{firstPageInfo:{objects:n,endpointApiRequest:o}}},r)})).then((()=>this.fetchNextPage()))):Promise.resolve()})),o()(this,"setButtonContainerRef",(e=>this.setState({buttonsContainerRef:e}))),o()(this,"getNextButtonStyle",(e=>{const{manualPaginatorButtonCss:{doNotAccountForLowerRightContent:t,nextButtonStyle:s}={},messagingContext:{offsetToAvoidLowerRightContentPx:n}}=this.props;if(t)return s;const{buttonsContainerRef:o}=this.state,i=o&&e?e-o.getBoundingClientRect().right:0;return{...s,transform:`translateX(-${i<n?n-i+x().lowerRightContentEdgeMarginPx:0}px)`}}))}render(){const{manualPaginatorButtonCss:{doNotAccountForLowerRightContent:e}={}}=this.props;return(0,k.jsxs)(k.Fragment,{children:[super.render(),!this.shouldRenderMainLoader()&&(e?this.renderPaginationButtons():(0,k.jsx)(c.U$,{children:e=>{let{bodyWidth:t}=e;return this.renderPaginationButtons(t)}}))]})}getEmptyInitialState(){var e,t,s;const n=null===(e=(t=this.props).getInitialPage)||void 0===e||null===(s=e.call(t))||void 0===s?void 0:s.prevLink;return{...super.getEmptyInitialState(),...N,...n&&{prevNextLinks:[n]}}}didChangeEndpoint(e){var t;const s=super.didChangeEndpoint(e)&&(!this.nextPageApiRequest||!(null!==(t=this.props.endpointApiRequest)&&void 0!==t&&t.isEqualTo(this.nextPageApiRequest)));return s&&(this.nextPageApiRequest=null),s}getFetchNextPageRequest(e){return this.nextPageApiRequest=super.getFetchNextPageRequest(e),this.nextPageApiRequest}onPagination(e){super.onPagination(e);const{requestType:t,response:s}=e,{getPrevLink:n}=this.props,o=null==n?void 0:n(s);this.setState((e=>({...[u.vO.Initial,u.vO.Refresh].includes(t)?N:e,...!!o&&{prevNextLinks:[o]}})))}}o()(O,"defaultProps",{...P.c});const I=(0,p.CN)(O,{appContext:!0,messagingContext:!0});(0,m.D)(I,`Inner${I.name}`);class F extends a.Component{render(){return(0,k.jsx)(I,{...this.props,ref:this.props.forwardedRef})}}const E=F},75379:(e,t,s)=>{s.d(t,{Z:()=>Y});var n=s(50209),o=s.n(n),i=s(5754),r=s.n(i),a=s(15867),l=s.n(a),d=s(29774),h=s(95004),c=s(67615),u=s(29583),p=s(43523),m=s(60023);var g=s(78667),b=s(22470),f=s(74446),x=s(93613),P=s(66591),v=s(2629);const C=e=>{let{children:t}=e;const[s,n]=(0,h.useState)({}),{apiFetch:o,logEvent:i}=(0,g.bp)(),{toggleToast:r}=(0,x.V)(),{onInjectTimelineObjects:a}=(0,f.i)(),l=async(e,t)=>{if(e&&t){const s=await function(e){let{apiFetch:t,blogId:s,postId:n}=e;return new m.x(t,`/v2/blog/${s}/posts/${n}`,{method:"GET"})}({apiFetch:o,blogId:e,postId:t}).fetch().catch((e=>{e instanceof P.Z&&r(e.message,"error")}));return s}},d={addInteractedRelatedPost:async(e,t,s)=>{n((n=>{var o;return(null===(o=n[t])||void 0===o?void 0:o.interactedPost)===e?n:(i({eventName:p.J.Impression,eventDetails:{serve_id:s,post_id:e}}),{...n,[t]:{...n[t],interactedPost:e,prevInteractedPost:n[t].interactedPost}})}))},addRelatedPosts:async(e,t)=>{const s=t[t.length-1].elements,o=await Promise.all(s.map((async e=>{let{objectData:{blogId:t,postId:s}}=e;const n=await l(t,s);return null==n?void 0:n.response}))),i=o.map((t=>({...t,parentPostId:e})));n((s=>({...s,[e]:{elements:t,posts:i.reduce(((e,t)=>(e[t.id]=t,e)),{}),interactedPost:"",prevInteractedPost:""}}))),a(e,i)},relatedPosts:s};return(0,v.jsx)(b.G.Provider,{value:d,children:t})};var T=s(13434),j=s(87224),y=s(48385),k=s(96467),S=s.n(k),R=s(31710);const N=function(e){const{width:t,margins:s=0,maximumNumberOfColumns:n,getNumberOfColumns:o,masonryProps:i}=e,{columnWidth:r,columnSpacing:a}=i,l=Math.min(isNaN(Number(n))?100:Number(n),(null==o?void 0:o(t))||Math.floor((t-2*s)/(r+a)));return t?(0,v.jsx)(R.Z,{...i,numberOfColumns:l}):null},O=function(e){let{masonryProps:t,masonryRendersWithSidebar:s,maximumNumberOfColumns:n}=e;const o=(0,h.useCallback)((e=>(0,v.jsx)(N,{width:e,masonryProps:{columnWidth:S().timelineMasonryPostWidth,columnSpacing:S().timelineMasonryPostSpacing,elementSpacing:S().timelineMasonryPostSpacing,...t},getNumberOfColumns:s?y.e$:y.vk,maximumNumberOfColumns:n})),[t]);return(0,v.jsx)(j.u,{breakpoints:s?y.XJ:y.Fe,children:o})};var I=s(26705),F=s(3457),E=s(94133),w=s(82651),Q=s(235),M=s(25190),V=s(63665),Z=s(5700),B=s(22979),L=s(90621),A=s(93415),U=s(59215),H=s(45051),q=s(78093),D=s.n(q),W=s(32156),G=s(60385),$=s(74708),J=s(93678);function _(e,t){return Number(e.scheduledPublishTime)-Number(t.scheduledPublishTime)}class K extends h.Component{constructor(){var e;super(...arguments),e=this,o()(this,"state",{isSorting:!1}),o()(this,"postRefs",this.props.forwardedPostRefs||[]),o()(this,"getTimelineContextValue",(0,d.Z)((e=>({displayMode:e,onReplyAdded:this.onReplyAdded,onReplyRemoved:this.onReplyRemoved,onLike:this.onLike,onReblogged:this.onReblogged,onFollow:this.onFollow,onNotesUpdate:this.onNotesUpdate,onQueueReorder:this.onQueueReorder,onRemoveTimelineObject:this.onRemoveTimelineObject,onInjectTimelineObjects:this.onInjectTimelineObjects,onPin:this.onPin,onPromote:this.onPromote,onEditTimelineObject:this.onEdit})))),o()(this,"getLoader",l()((e=>(0,v.jsx)("div",{className:G.Z.loader,children:(0,v.jsx)(T.Z,{centerOrientation:T.Q.Horizontal,color:e})})),{maxSize:50})),o()(this,"getEmptyView",l()((e=>(0,v.jsx)("div",{className:r()(G.Z.noContent,{[G.Z.masonryEmptyView]:e===B.mt.Masonry}),children:this.props.appContext._c("String to show when there are no posts in a timeline (e.g., no likes on /likes, no results for /tagged/atagnoonehasused).","No posts available.")})))),o()(this,"renderTimelineElements",(e=>{let{objects:t,refresh:s,transformObjects:n,relatedPostsContext:o}=e;const{displayMode:i,isQueue:a,maximumNumberOfColumns:l,masonryColumnWidth:d,masonryMarginTop:h,masonryRendersWithSidebar:u,setRefreshCallback:p,isElementPinnedToMasonryUpperRight:m,timelineObjectClassName:g}=this.props;this.transformObjects=n,null==p||p(s);const b=[],f=t.reduce(((e,s,n)=>{null!=m&&m(s)&&b.push(n);const i=null==o?void 0:o.relatedPosts;if(s.parentPostId&&(null==i||!i[null==s?void 0:s.id]))return e;if(null!=i&&i[null==s?void 0:s.id]){const o=[...e],a=Object.values(i).find((e=>e.interactedPost===s.id));return i[s.id]&&!a&&o.push(this.renderElement(s,n)),i[s.id].elements.map(((e,s)=>{const i=t.find((t=>t.id===e.id));i&&o.push(this.renderElement(i,n+s+1))})),i[s.id].interactedPost&&o.push((0,v.jsx)("div",{className:G.Z.animateContainerIn,children:[...Object.values(i[s.id].posts).map((e=>{const o=t.find((t=>t.id===e.id)),a=i[s.id].interactedPost,l=i[s.id].prevInteractedPost,d=r()(g,{[G.Z.animateIn]:a===e.id,[G.Z.animateOut]:l===e.id,[G.Z.none]:e.id!==a&&e.id!==l});return this.renderElement({...e,...o,className:d},n)}))]},s.id)),o}return[...e,this.renderElement(s,n)]}),[]);if(i===B.mt.Masonry)return(0,v.jsx)(O,{masonryProps:{pinnedToUpperRightIndexes:b,children:f,...d&&{columnWidth:d,elementSpacing:h}},maximumNumberOfColumns:l,masonryRendersWithSidebar:u});if(a){const e=(0,v.jsx)(Q.Jj.Provider,{value:this.getQueueContext(t),children:f});return(0,v.jsx)(M.ZP,{children:t=>{let{isMobile:s}=t;return s?e:(0,v.jsx)(E.Z,{fallback:null,children:(0,v.jsx)(c.Z,{className:"sortableContainer",options:{animation:150,onStart:this.onQueueSortStart,onEnd:this.onQueueSortEnd,draggable:`.${J.Z.sortDragDropTarget}`,handle:`.${$.Z.reorderButton}`,forceFallback:!0},onChange:H.Z,children:e})})}})}return(0,v.jsx)("div",{className:i===B.mt.Grid?G.Z.gridded:null,children:f})})),o()(this,"renderElement",((e,t)=>{const{timelineObjectClassName:s,gridChildren:n,hoverContent:o}=this.props,{clientInnerHeight:i}=this.state,a=`${e.placementId?`${e.placementId}:`:""}${e.id}${e.isExpandedInGrid?":expanded":""}`;return(0,v.jsx)(w.ZP,{ref:e=>this.postRefs[t]=e,className:r()(s,e.className),presentationStyle:this.props.overridePresentationStyle,timelineObject:{...e},displayMode:this.props.displayMode,toggleExpandedInGrid:this.toggleExpandedInGrid,isInboxTimeline:this.props.isInboxTimeline,clientInnerHeight:i,gridChildren:n,hoverContent:o,index:t},a)})),o()(this,"getManualPaginatorButtonCSS",(()=>{const{displayMode:e,manualPaginatorButtonCss:t}=this.props;return{...t&&t,containerClassName:e===B.mt.Grid?G.Z.manualPaginatorButtonsGrid:null}})),o()(this,"apiQueueSort",((e,t)=>{const{apiFetch:s}=this.props.appContext,{blogName:n,id:o,insertAfter:i,oldIndex:r}=e;return n?(0,L.wW)(s,{blogName:n,id:o,insertAfter:i}).fetch().catch((()=>t(o,r))):(t(o,r),Promise.reject())})),o()(this,"onQueueSortStart",(()=>{this.setState({isSorting:!0})})),o()(this,"onQueueSortEnd",(e=>{this.setState({isSorting:!1});const t=this.getSortParameters(e);this.onQueueReorder(t.id,t.newIndex),this.apiQueueSort({...t},this.onQueueReorder)})),o()(this,"onNoteStatusUpdated",((e,t)=>{this.transformObjects((s=>s.map((s=>{if(!(0,B.xT)(s)||s.id!==e)return s;const n=t(s);return this.maybeUpdateDockedPost(n),n}))))})),o()(this,"onReplyAdded",(e=>this.onNoteStatusUpdated(e,(e=>(0,W.Js)(e))))),o()(this,"onReplyRemoved",(e=>this.onNoteStatusUpdated(e,(e=>(0,W.RN)(e))))),o()(this,"onReblogged",(e=>this.onNoteStatusUpdated(e,(e=>(0,W.ql)(e))))),o()(this,"onLike",((e,t)=>this.onNoteStatusUpdated(e,(e=>(0,W.bX)(e,t))))),o()(this,"onNotesUpdate",((e,t)=>this.onNoteStatusUpdated(e,(e=>(0,W.Pl)(e,t))))),o()(this,"onEdit",(e=>{this.transformObjects((t=>t.map((t=>(0,B.xT)(t)&&t.id===e.id?e:t))))})),o()(this,"onPin",((e,t)=>{this.transformObjects((s=>s.map((s=>(0,B.xT)(s)?s.id!==e?t&&s.isPinned?{...s,isPinned:!1}:s:{...s,isPinned:t}:s))))})),o()(this,"onFollow",(function(t){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.transformObjects((n=>n.map((n=>{if((0,B.xT)(n)){const o=(0,W.dQ)(n,t,s);return e.maybeUpdateDockedPost(o),o}return n}))))})),o()(this,"onPromote",((e,t)=>{this.transformObjects((s=>s.map((s=>{if((0,B.xT)(s)&&s.id===e){const e=(0,W.ST)(s,t);return this.maybeUpdateDockedPost(e),e}return s}))))})),o()(this,"onQueueReorder",((e,t)=>{this.transformObjects((s=>{const n=s.find((t=>t.id===e));if(void 0===n)return s;const o=s.filter((e=>Z.hA.Queued===e.state&&Z.SH.Scheduled===e.queuedState)),i=s.filter((e=>Z.hA.Queued===e.state&&Z.SH.Queued===e.queuedState)),r=i.map(((e,t)=>e.scheduledPublishTime)),a=i.indexOf(n),l=[...i];l.splice(t,0,l.splice(a,1)[0]);return[...o,...l.map(((e,t)=>(e.scheduledPublishTime=r[t],e)))].sort(_)}))})),o()(this,"onInjectTimelineObjects",((e,t)=>{this.transformObjects((s=>{const n=s.findIndex((t=>t.id===e));if(-1===n)return s;const o=[...s];return o.splice(n+1,0,...t),o}))})),o()(this,"onRemoveTimelineObject",(e=>{let t,s,n,o,{id:i,wasBlogUnfollowed:r}=e;const{isQueue:a,displayMode:l,doesNotRemoveUnfollowedObjects:d,postCountContext:{refreshCounts:h}}=this.props;if(d&&r)return H.Z;if(l===B.mt.Grid){const e=(0,w.l9)();this.toggleExpandedInGrid({id:i,hasExpandedVersionBelowIt:!0},e)}this.transformObjects((e=>{s=[...e];const r=e.find((e=>e.id===i));if(void 0===r)return e;if(t=e.indexOf(r),o=(0,B.xT)(r),n=[...e],n.splice(t,1),o&&a&&r.state===Z.hA.Queued&&r.queuedState===Z.SH.Queued){const t=e.filter((e=>e.state===Z.hA.Queued&&e.queuedState===Z.SH.Queued)).map((e=>e.scheduledPublishTime)),s=n.filter((e=>e.state===Z.hA.Queued&&e.queuedState===Z.SH.Scheduled)),o=n.filter((e=>e.state===Z.hA.Queued&&e.queuedState===Z.SH.Queued));n=[...s,...o.map(((e,s)=>(e.scheduledPublishTime=t[s],e)))].sort(_)}return e[t].animateOut=!0,e}));return setTimeout((()=>{this.transformObjects((e=>n)),h(),this.postRefs.pop()}),D().postSlideOutDurationInMs),()=>this.transformObjects((()=>s))})),o()(this,"toggleExpandedInGrid",((e,t)=>{this.props.displayMode===B.mt.Grid&&this.transformObjects((s=>{const n=s.findIndex((t=>{let{id:s}=t;return s===e.id}));if(-1===n)return s;let o=0;for(let e=0;e<s.length&&!(e>=n);e+=1){s[e].isExpandedInGrid&&(o+=1)}const i=t-(n+o*(t-1))%t,r=n+i;for(let e=n-(t-i);e<r;e+=1){const t={...s[e]};delete t.hasExpandedVersionBelowIt,s[e]=t}const a=s[r]&&s[r].isExpandedInGrid?r+1:r;if(e.hasExpandedVersionBelowIt){return[...s.slice(0,r),...s.slice(a,s.length)]}const l={...structuredClone(e),isExpandedInGrid:!0},d=[...s.slice(0,r),l,...s.slice(a,s.length)];return d[n]={...d[n],hasExpandedVersionBelowIt:!0},d}))})),o()(this,"getPostRefs",(()=>this.postRefs))}componentDidMount(){var e,t;null===(e=(t=this.props.dockableContext).setTimelineContext)||void 0===e||e.call(t,this.getTimelineContextValue(this.props.displayMode)),this.setState({clientInnerHeight:window.innerHeight})}componentDidUpdate(e){if(e.displayMode!==this.props.displayMode){const e={[B.mt.Grid]:p.J.TimelineDisplayModeToggleGrid,[B.mt.List]:p.J.TimelineDisplayModeToggleList,[B.mt.Masonry]:p.J.TimelineDisplayModeToggleMasonry}[this.props.displayMode];this.props.appContext.logEvent({eventName:e})}}render(){const{isSorting:e}=this.state,{debug:t,displayMode:s,onPagination:n,onPaginationError:o,hidesPullToRefresh:i,getNextLink:a,endpointApiRequest:l,getInitialPage:d,isObjectOmittedFromRender:h,getObjectsFromResponse:c,knightRiderLoaderColor:p,scrollContainer:m,emptyView:g,errorView:x,isQueue:P,prevButtonIsRefresh:T,getPrevLink:j,updateUrlFromCurrentPageLink:y,appContext:{endlessScrollingDisabled:k}}=this.props,S={debug:t,endpointApiRequest:l,scrollContainer:m,errorView:x,onPagination:n,onPaginationError:o,getNextLink:a,getInitialPage:d,getObjectsFromResponse:c,isObjectOmittedFromRender:h,updateUrlFromCurrentPageLink:y,loader:this.getLoader(p),pullToRefresh:!i,lockScrollOnObjectUpdate:P,emptyView:g||this.getEmptyView(s)};return(0,v.jsx)(f.k.Provider,{value:this.getTimelineContextValue(this.props.displayMode),children:(0,v.jsx)(C,{children:(0,v.jsx)(b.G.Consumer,{children:t=>(0,v.jsx)("div",{className:r()(G.Z.timeline,{[G.Z.isSorting]:e,[G.Z.masonry]:s===B.mt.Masonry}),"data-timeline":null==l?void 0:l.getGivenPath(),"data-which":null==l?void 0:l.getWhichQueryParam(),children:(0,v.jsx)(A.I.Provider,{value:m&&(0,V.Re)(m)?m:null,children:(0,v.jsx)(u.ZP,{disabled:[B.mt.Grid,B.mt.Masonry].includes(s),getPostRefs:this.getPostRefs,children:k?(0,v.jsx)(F.ZP,{...S,getPrevLink:j,prevButtonIsRefresh:T,manualPaginatorButtonCss:this.getManualPaginatorButtonCSS(),children:e=>this.renderTimelineElements({...e,relatedPostsContext:t})}):(0,v.jsx)(I.ZP,{...S,fetchDistance:1600,children:e=>this.renderTimelineElements({...e,relatedPostsContext:t})})})})})})})})}getQueueContext(e){return{allPosts:e.map((e=>e.id)),queuedPosts:e.filter((e=>Z.hA.Queued===e.state&&Z.SH.Queued===e.queuedState)).map((e=>e.id))}}getSortParameters(e){const t=e.item.dataset.id;let s,n=0,o=-1,i=-1;return this.transformObjects((r=>{const a=r.filter((e=>Z.hA.Queued===e.state&&Z.SH.Queued===e.queuedState)).map((e=>e.id)),l=r.find((e=>e.id===t));return s=null==l?void 0:l.blogName,i=a.findIndex((t=>r[e.oldIndex].id===t)),o=a.findIndex((t=>r[e.newIndex].id===t)),n=r[e.newIndex-1]&&r[e.newIndex-1].id||0,r})),{blogName:s,id:t,insertAfter:n,oldIndex:i,newIndex:o}}maybeUpdateDockedPost(e){const{isMediaDocked:t,dockedTimelineObject:s,setDockedTimelineObject:n}=this.props.dockableContext;t&&e.id===(null==s?void 0:s.id)&&n(e)}}o()(K,"defaultProps",{hidesPullToRefresh:!1,displayMode:B.mt.List,errorView:null,getNextLink:e=>{var t,s,n;return null==e||null===(t=e.response)||void 0===t||null===(s=t.timeline)||void 0===s||null===(n=s.links)||void 0===n?void 0:n.next}});const X=(0,U.X9)(K,{appContext:!0,postCountContext:!0,dockableContext:!0,relatedPostsContext:!0,timelineContext:!0});class z extends h.Component{render(){return(0,v.jsx)(X,{...this.props})}}o()(z,"defaultProps",K.defaultProps);const Y=z},87224:(e,t,s)=>{s.d(t,{u:()=>c});var n=s(50209),o=s.n(n),i=s(95004),r=s(10381),a=s(18599),l=s(78667),d=s(2629);class h extends i.Component{constructor(){super(...arguments),o()(this,"state",{matchedBreakpoint:void 0})}static getDerivedStateFromProps(e,t){let{width:s,breakpoints:n}=e;const o=((e,t)=>[...t].reverse().find((t=>t<=e)))(s,n);return o===t.matchedBreakpoint?null:{matchedBreakpoint:o}}shouldComponentUpdate(e,t){return t.matchedBreakpoint!==this.state.matchedBreakpoint||this.props.children!==e.children}render(){return this.props.children(this.props.width)}}function c(e){const{getBrowserInfo:t}=(0,l.bp)(),s=(0,a.AJ)(t());return e.width?(0,d.jsx)(h,{...e}):(0,d.jsx)(r.U$,{children:t=>{let{width:n,bodyWidth:o}=t;return(0,d.jsx)(h,{...e,width:s?o:n})}})}},48385:(e,t,s)=>{s.d(t,{Fe:()=>r,XJ:()=>l,e$:()=>h,vk:()=>d});var n=s(96467),o=s.n(n);const i=o().timelineMasonryPostWidth+o().timelineMasonryPostSpacing,r=[2*i,3*i,4*i],a=o().sidebarWidth+o().sidebarMargin,l=r.map((e=>e+a)),d=(e,t)=>c(e,!!t),h=e=>c(e,!0),c=(e,t)=>Math.min(2+r.length-1,Math.max(Math.floor((e-(t?a:0))/i),1))}}]);