"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[5379],{60385:(e,t,n)=>{n.d(t,{Z:()=>s});const s={timeline:"j8ha0",isSorting:"avWLs",masonry:"qr36f",gridded:"RlWaM",loader:"IKfVk",noContent:"cRPdZ",masonryEmptyView:"GWJvH",manualPaginatorButtonsGrid:"Tj4be",restoreTimelineText:"rqHFc",animateOut:"x7_ZU",animateIn:"O5WoU",animateContainerIn:"E4obd",none:"ZRX9S"}},67615:(e,t,n)=>{n.d(t,{Z:()=>s});const s=(0,n(95004).lazy)((()=>n.e(9717).then(n.t.bind(n,94497,23))))},29583:(e,t,n)=>{n.d(t,{ZA:()=>s,ZP:()=>C,j0:()=>x});var s,i=n(44027),o=n.n(i),r=n(50209),a=n.n(r),l=n(95004),d=n(235),u=n(5700),h=n(81584),c=n(59215),p=n(66591),m=n(96467),g=n.n(m),v=n(6790),b=n(2629);!function(e){e.Next="next",e.Previous="previous"}(s||(s={}));var f={canFastQueue:!1,canFastReblog:!1,canFastQuote:!1},x=-(g().desktopHeaderHeightPx+g().marginBetweenPosts);class P extends l.Component{constructor(e){super(e),a()(this,"apiHelper",(0,h.ZP)(this.props.appContext.apiFetch)),a()(this,"blogs",[]),a()(this,"getBlogs",(()=>this.blogs)),a()(this,"setDefaultFastBlog",(e=>{this.blogs.sort(((t,n)=>n.name===e.name?1:t.name===e.name?-1:0))})),a()(this,"renderScrollPositionDependentHotkeys",(()=>(0,b.jsx)(v.ZP,{hotkey:[{key:v.SV.J,command:this.scrollToNextElement},{key:v.SV.K,command:this.scrollToPreviousElement},{key:v.SV.L,command:this.likeVisibleTimelineObject},{key:v.SV.R,command:this.reblogVisibleTimelineObject,modifiers:{[v.TE.Alt]:!0}}]}))),a()(this,"enableFastReblog",(()=>!this.state.canFastReblog&&this.setState({canFastReblog:!0}))),a()(this,"disableFastReblog",(()=>this.state.canFastReblog&&this.setState({canFastReblog:!1}))),a()(this,"enableFastQueue",(()=>!this.state.canFastQueue&&this.setState({canFastQueue:!0}))),a()(this,"disableFastQueue",(()=>this.state.canFastQueue&&this.setState({canFastQueue:!1}))),a()(this,"enableFastQuote",(()=>!this.state.canFastQuote&&this.setState({canFastQuote:!0}))),a()(this,"disableFastQuote",(()=>this.state.canFastQuote&&this.setState({canFastQuote:!1}))),a()(this,"isValidElement",(e=>!(null==e||!e.ref))),a()(this,"scrollToNextElement",(()=>{this.scrollToElement(s.Next)})),a()(this,"scrollToPreviousElement",(()=>{this.scrollToElement(s.Previous)})),a()(this,"scrollToElement",(e=>{if(this.props.scrollToElement)return this.props.scrollToElement(e);var t=this.props,n=t.scrollContainerContext,i=t.getPostRefs,o=t.appContext.isModalShowing,r=t.dashboardContext.preventTabbedDashboardAppearOnNextScroll,a=n||document.documentElement,l=[...i()];e===s.Previous&&(l.reverse(),null==r||r());for(var d,u=Math.ceil(a.scrollTop),h=0,c=l;h<c.length;h++){var p=c[h];if(this.isValidElement(p)){var m=p.ref,v=void 0!==(null==(d=m.offsetParent)?void 0:d.offsetTop)?m.offsetParent.offsetTop:0,b=m.offsetTop+v,f=u-b,P=o?-g().marginBetweenPosts:x;if(e===s.Next?f<P:f>P)return m.focus({preventScroll:!0}),void a.scrollTo({left:0,top:b+P})}}if(e===s.Next){var C=n?n.scrollHeight:document.body.scrollHeight;a.scrollTo({left:0,top:C})}})),a()(this,"scrollToTop",(()=>{if(this.props.scrollToTop)return this.props.scrollToTop();(this.props.scrollContainerContext||document.documentElement).scrollTo({behavior:"smooth",left:0,top:0})})),a()(this,"likeVisibleTimelineObject",(()=>{var e=this.getVisibleTimelineObject().props.timelineObject,t=e.liked,n=e.id,s=e.reblogKey,i=e.blogName,o=e.placementId,r=e.earnedId,a=this.props,l=a.timelineContext.onLike,d=a.appContext.logEvent;return this.apiHelper.likePost({id:n,liked:t,reblogKey:s,blogName:i,placementId:o,earnedId:r,logEvent:d,onLike:l}).fetch().catch((e=>{var t=this.props.toastContext.toggleToast;e instanceof p.Z&&t(e.message,"error")}))})),a()(this,"reblogVisibleTimelineObject",(()=>this.postVisibleTimelineObject(u.hA.Published,this.props.appContext._t("Reblogged!")))),a()(this,"queueVisibleTimelineObject",(()=>this.postVisibleTimelineObject(u.hA.Queue,this.props.appContext._t("Queued!")))),a()(this,"postVisibleTimelineObject",((e,t)=>{var n=this.getVisibleTimelineObject().props.timelineObject.placementId,s=this.props,i=s.appContext,o=i.getUserInfo,r=i._c,a=i.logEvent,l=s.toastContext.toggleToast,d=this.getVisibleTimelineObject().props.timelineObject;return o().then((s=>{var i=s.name,o=d.blog,r=d.id,u=d.reblogKey,h=d.earnedId;return this.apiHelper.postAPost({selectedBlogName:i,placementId:n,logEvent:a,post:{reblogKey:u,earnedId:h,content:[],state:e,parentTumblelogUuid:o.name,parentPostId:r,id:void 0}}).fetch((()=>(this.setState({fastRebloggedPosts:this.state.fastRebloggedPosts.concat([d.id])}),l(t))))})).catch((()=>l(r("Failed to do action","Failed"))))})),a()(this,"getVisibleTimelineObject",(()=>{var e,t=this.props.scrollContainerContext,n=this.props.getPostRefs(),s=Math.ceil((t||document.documentElement).scrollTop),i=o()(n);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(this.isValidElement(r)){var a,l=r.ref;if(s-(t?l.offsetTop+((null===(a=l.offsetParent)||void 0===a?void 0:a.offsetTop)||0):l.offsetTop)<l.clientHeight+x)return r}}}catch(e){i.e(e)}finally{i.f()}})),a()(this,"unsetCanFastAction",(()=>this.setState(f))),this.state={canFastReblog:!1,canFastQueue:!1,canFastQuote:!1,fastRebloggedPosts:[],setDefaultFastBlog:this.setDefaultFastBlog,getBlogs:this.getBlogs}}componentDidMount(){return window.addEventListener("blur",this.unsetCanFastAction),this.props.appContext.getUserInfo().then((e=>{var t=e.blogs,n=void 0===t?[]:t;this.blogs=[...n]}))}componentWillUnmount(){window.removeEventListener("blur",this.unsetCanFastAction)}render(){var e=this.props,t=e.disabled,n=e.children,s=this.state,i=s.canFastReblog,o=s.canFastQueue,r=s.canFastQuote,a=s.altPressed;return(0,b.jsxs)(b.Fragment,{children:[!t&&this.renderScrollPositionDependentHotkeys(),i&&(0,b.jsx)(v.ZP,{hotkey:{key:v.SV.E,command:this.disableFastReblog,firesOnKeyUp:!0}}),o&&(0,b.jsx)(v.ZP,{hotkey:{key:v.SV.W,command:this.disableFastQueue,firesOnKeyUp:!0}}),r&&(0,b.jsx)(v.ZP,{hotkey:{key:v.SV.Q,command:this.disableFastQuote,firesOnKeyUp:!0}}),!t&&a&&(0,b.jsx)(v.ZP,{hotkey:[{key:v.SV.Q,command:this.queueVisibleTimelineObject,modifiers:{[v.TE.Alt]:!0}},{key:v.SV.Alt,command:()=>this.setState({altPressed:!1}),firesOnKeyUp:!0}]}),!t&&!a&&(0,b.jsx)(v.ZP,{hotkey:[{key:v.SV.Q,command:this.enableFastQuote},{key:v.SV.Alt,command:()=>this.setState({altPressed:!0})}]}),(0,b.jsx)(v.ZP,{hotkey:[{key:v.SV.Dot,command:this.scrollToTop},{key:v.SV.E,command:this.enableFastReblog},{key:v.SV.W,command:this.enableFastQueue}]}),(0,b.jsx)(d.ZP.Provider,{value:this.state,children:n})]})}}const C=(0,c.X9)(P,{appContext:!0,dashboardContext:!0,toastContext:!0,timelineContext:!0,scrollContainerContext:!0})},3457:(e,t,n)=>{n.d(t,{ZP:()=>Q});var s=n(54138),i=n.n(s),o=n(50209),r=n.n(o),a=n(5754),l=n.n(a),d=n(95004),u=n(79615),h=n(6790),c=n(98384),p=n(10381),m=n(63665),g=n(59215),v=n(7070),b=n(63583),f=n.n(b),x=n(96467),P=n.n(x),C=n(64051);const k="m3lOJ",T="PY8Tb",j="B5txQ",y="jIdvc",S="Xp6EK";var R=n(2629),N={width:13,height:13},O={href:"DON'T FETCH ME! OH GUY, PLEASE DON'T FETCH ME!"},I={prevNextLinks:[],linkForCurrentPage:O};class F extends C.Z{constructor(){super(...arguments),r()(this,"addObjectsToExisting",this.props.concatenate?e=>{var t=this.state.objects,n=this.props,s=n.direction,i=n.getObjectsFromResponse;return s===m.cU.Top?i(e).concat(t):t.concat(i(e))}:this.props.getObjectsFromResponse),r()(this,"shouldRenderMainLoader",(()=>{var e=this.state,t=e.hasFetchedInitialPage,n=e.loadingNextPage;return!t||n})),r()(this,"preHandleContentFetch",(e=>{var t=this.props.updateUrlFromCurrentPageLink,n=this.state.linkForCurrentPage;switch(e){case m.vO.Initial:return;case m.vO.Refresh:return void(null==t||t());case m.vO.Pagination:return void(null==t||t(null==n?void 0:n.href))}})),r()(this,"getHotkeyCommands",(()=>{var e=this.state,t=e.prevNextLinks,n=e.nextLink,s=[];return 0!==t.length&&s.push({key:h.SV.Left,command:this.onClickPrevious}),n&&s.push({key:h.SV.Right,command:this.onClickNext}),s})),r()(this,"renderPaginationButtons",(e=>{var t=this.state,n=t.prevNextLinks,s=t.nextLink,o=this.props,r=o.prevButtonIsRefresh,a=o.manualPaginatorButtonCss,p=(a=void 0===a?{}:a).containerClassName,m=a.prevButtonStyle,g=a.nextButtonStyle,v=o.appContext._c,b=o.nextButton,x=o.concatenate,P=v("The label for a button to return to the previous page of results","Previous"),C=v("The label for a button to refresh the contents of a set of posts to show the newest content in it","Latest"),O=v("The label for a button to go to the next page of results","Next"),I=!!n.length,F=I?this.onClickPrevious:this.refresh,E=I?P:C,w=I?{color:f().paletteWhite,background:f().paletteTransparentWhite65}:{color:f().paletteTransparentWhite87,background:"transparent",border:"2px solid ".concat(f().paletteTransparentWhite87)},Q=!x&&I||r,M=!!s;return Q||M?(0,R.jsxs)("div",{ref:this.setButtonContainerRef,className:l()(k,p),children:[(0,R.jsx)(h.ZP,{hotkey:this.getHotkeyCommands()}),Q&&(0,R.jsxs)(u.Z,{label:P,wrapperClassName:l()(T,y),wrapperStyle:i()(i()({},w),m),className:S,onClick:F,children:[(0,R.jsx)(c.sz,{size:N,colors:{primary:(null==m?void 0:m.color)||w.color||"currentcolor"}}),E]}),M&&(b?(0,d.cloneElement)(b,{label:O,onClick:this.onClickNext}):(0,R.jsxs)(u.Z,{label:O,wrapperClassName:l()(T,j),wrapperStyle:i()({color:f().paletteWhite,background:f().paletteAccent},this.getNextButtonStyle(e)),className:S,onClick:this.onClickNext,children:[O,(0,R.jsx)(c.iL,{size:N,colors:{primary:g&&g.color||f().paletteWhite}})]}))]}):null})),r()(this,"onClickPrevious",(()=>{var e=this.state,t=e.prevNextLinks,n=e.firstPageInfo,s=e.linkForCurrentPage,o=this.props.updateUrlFromCurrentPageLink,r=t.pop();if(!this.canFetchNextPage(r))return Promise.resolve();if(r===O&&n){var a=n.endpointApiRequest,l=n.objects;return this.nextPageApiRequest=a,null==o||o(a.getSearchParams(),!0),this.setState(i()(i()({},I),{},{objects:l,nextLink:s}),this.scrollToBottom),Promise.resolve()}return this.scrollToTop(),new Promise((e=>{this.setState({prevNextLinks:t,objects:[],linkForCurrentPage:r},e)})).then((()=>this.fetchNextPage(r))).then((()=>this.scrollToBottom()))})),r()(this,"onClickNext",(()=>{var e=this.state,t=e.prevNextLinks,n=e.linkForCurrentPage,s=e.nextLink,o=e.objects,r=this.props,a=r.endpointApiRequest,l=r.concatenate;return this.canFetchNextPage(s)&&a?(l||this.scrollToTop(),new Promise((e=>{this.setState(i()({objects:l?this.state.objects:[],prevNextLinks:[...t,n],linkForCurrentPage:s},n===O&&{firstPageInfo:{objects:o,endpointApiRequest:a}}),e)})).then((()=>this.fetchNextPage()))):Promise.resolve()})),r()(this,"setButtonContainerRef",(e=>this.setState({buttonsContainerRef:e}))),r()(this,"getNextButtonStyle",(e=>{var t=this.props,n=t.manualPaginatorButtonCss,s=(n=void 0===n?{}:n).doNotAccountForLowerRightContent,o=n.nextButtonStyle,r=t.messagingContext.offsetToAvoidLowerRightContentPx;if(s)return o;var a=this.state.buttonsContainerRef,l=a&&e?e-a.getBoundingClientRect().right:0;return i()(i()({},o),{},{transform:"translateX(-".concat(l<r?r-l+P().lowerRightContentEdgeMarginPx:0,"px)")})}))}render(){var e=this.props.manualPaginatorButtonCss,t=(e=void 0===e?{}:e).doNotAccountForLowerRightContent;return(0,R.jsxs)(R.Fragment,{children:[super.render(),!this.shouldRenderMainLoader()&&(t?this.renderPaginationButtons():(0,R.jsx)(p.U$,{children:e=>{var t=e.bodyWidth;return this.renderPaginationButtons(t)}}))]})}getEmptyInitialState(){var e,t,n,s=null===(e=(t=this.props).getInitialPage)||void 0===e||null===(n=e.call(t))||void 0===n?void 0:n.prevLink;return i()(i()(i()({},super.getEmptyInitialState()),I),s&&{prevNextLinks:[s]})}didChangeEndpoint(e){var t,n=super.didChangeEndpoint(e)&&(!this.nextPageApiRequest||!(null!==(t=this.props.endpointApiRequest)&&void 0!==t&&t.isEqualTo(this.nextPageApiRequest)));return n&&(this.nextPageApiRequest=null),n}getFetchNextPageRequest(e){return this.nextPageApiRequest=super.getFetchNextPageRequest(e),this.nextPageApiRequest}onPagination(e){super.onPagination(e);var t=e.requestType,n=e.response,s=this.props.getPrevLink,o=null==s?void 0:s(n);this.setState((e=>i()(i()({},[m.vO.Initial,m.vO.Refresh].includes(t)?I:e),!!o&&{prevNextLinks:[o]})))}}r()(F,"defaultProps",i()({},C.c));var E=(0,g.CN)(F,{appContext:!0,messagingContext:!0});(0,v.D)(E,"Inner".concat(E.name));class w extends d.Component{render(){return(0,R.jsx)(E,i()(i()({},this.props),{},{ref:this.props.forwardedRef}))}}const Q=w},75379:(e,t,n)=>{n.d(t,{Z:()=>le});var s=n(54138),i=n.n(s),o=n(50209),r=n.n(o),a=n(5754),l=n.n(a),d=n(15867),u=n.n(d),h=n(29774),c=n(95004),p=n(67615),m=n(29583),g=n(17276),v=n.n(g),b=n(99077),f=n.n(b),x=n(33970),P=n.n(x),C=n(43523),k=n(60023);function T(e){var t=e.apiFetch,n=e.blogId,s=e.postId;return new k.x(t,"/v2/blog/".concat(n,"/posts/").concat(s),{method:"GET"})}var j=n(78667),y=n(22470),S=n(74446),R=n(93613),N=n(66591),O=n(2629);const I=e=>{var t,n,s=e.children,o=(0,c.useState)({}),r=P()(o,2),a=r[0],l=r[1],d=(0,j.bp)(),u=d.apiFetch,h=d.logEvent,p=(0,R.V)().toggleToast,m=(0,S.i)().onInjectTimelineObjects,g=function(){var e=f()(v()().mark((function e(t,n){var s;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=5;break}return e.next=3,T({apiFetch:u,blogId:t,postId:n}).fetch().catch((e=>{e instanceof N.Z&&p(e.message,"error")}));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),b={addInteractedRelatedPost:(n=f()(v()().mark((function e(t,n,s){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l((e=>{var o;return(null===(o=e[n])||void 0===o?void 0:o.interactedPost)===t?e:(h({eventName:C.J.Impression,eventDetails:{serve_id:s,post_id:t}}),i()(i()({},e),{},{[n]:i()(i()({},e[n]),{},{interactedPost:t,prevInteractedPost:e[n].interactedPost})}))}));case 1:case"end":return e.stop()}}),e)}))),function(e,t,s){return n.apply(this,arguments)}),addRelatedPosts:(t=f()(v()().mark((function e(t,n){var s,o,r;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n[n.length-1].elements,e.next=3,Promise.all(s.map(function(){var e=f()(v()().mark((function e(t){var n,s,i,o;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.objectData,s=n.blogId,i=n.postId,e.next=3,g(s,i);case 3:return o=e.sent,e.abrupt("return",null==o?void 0:o.response);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:o=e.sent,r=o.map((e=>i()(i()({},e),{},{parentPostId:t}))),l((e=>i()(i()({},e),{},{[t]:{elements:n,posts:r.reduce(((e,t)=>(e[t.id]=t,e)),{}),interactedPost:"",prevInteractedPost:""}}))),m(t,r);case 7:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)}),relatedPosts:a};return(0,O.jsx)(y.G.Provider,{value:b,children:s})};var F=n(13434),E=n(87224),w=n(48385),Q=n(96467),M=n.n(Q),V=n(31710);const Z=function(e){var t=e.width,n=e.margins,s=void 0===n?0:n,o=e.maximumNumberOfColumns,r=e.getNumberOfColumns,a=e.masonryProps,l=a.columnWidth,d=a.columnSpacing,u=Math.min(isNaN(Number(o))?100:Number(o),(null==r?void 0:r(t))||Math.floor((t-2*s)/(l+d)));return t?(0,O.jsx)(V.Z,i()(i()({},a),{},{numberOfColumns:u})):null};const B=function(e){var t=e.masonryProps,n=e.masonryRendersWithSidebar,s=e.maximumNumberOfColumns,o=(0,c.useCallback)((e=>(0,O.jsx)(Z,{width:e,masonryProps:i()({columnWidth:M().timelineMasonryPostWidth,columnSpacing:M().timelineMasonryPostSpacing,elementSpacing:M().timelineMasonryPostSpacing},t),getNumberOfColumns:n?w.e$:w.vk,maximumNumberOfColumns:s})),[t]);return(0,O.jsx)(E.u,{breakpoints:n?w.XJ:w.Fe,children:o})};var L=n(26705),A=n(3457),U=n(94133),H=n(82651),q=n(235),D=n(25190),W=n(63665),G=n(5700),J=n(22979),_=n(90621),K=n(93415),X=n(59215),z=n(45051),$=n(78093),Y=n.n($),ee=n(32156),te=n(60385),ne=n(74708),se=n(93678);function ie(e,t){return Number(e.scheduledPublishTime)-Number(t.scheduledPublishTime)}class oe extends c.Component{constructor(){var e;super(...arguments),e=this,r()(this,"state",{isSorting:!1}),r()(this,"postRefs",this.props.forwardedPostRefs||[]),r()(this,"getTimelineContextValue",(0,h.Z)((e=>({displayMode:e,onReplyAdded:this.onReplyAdded,onReplyRemoved:this.onReplyRemoved,onLike:this.onLike,onReblogged:this.onReblogged,onFollow:this.onFollow,onNotesUpdate:this.onNotesUpdate,onQueueReorder:this.onQueueReorder,onRemoveTimelineObject:this.onRemoveTimelineObject,onInjectTimelineObjects:this.onInjectTimelineObjects,onPin:this.onPin,onPromote:this.onPromote,onEditTimelineObject:this.onEdit})))),r()(this,"getLoader",u()((e=>(0,O.jsx)("div",{className:te.Z.loader,children:(0,O.jsx)(F.Z,{centerOrientation:F.Q.Horizontal,color:e})})),{maxSize:50})),r()(this,"getEmptyView",u()((e=>(0,O.jsx)("div",{className:l()(te.Z.noContent,{[te.Z.masonryEmptyView]:e===J.mt.Masonry}),children:this.props.appContext._c("String to show when there are no posts in a timeline (e.g., no likes on /likes, no results for /tagged/atagnoonehasused).","No posts available.")})))),r()(this,"renderTimelineElements",(e=>{var t=e.objects,n=e.refresh,s=e.transformObjects,o=e.relatedPostsContext,r=this.props,a=r.displayMode,d=r.isQueue,u=r.maximumNumberOfColumns,h=r.masonryColumnWidth,c=r.masonryMarginTop,m=r.masonryRendersWithSidebar,g=r.setRefreshCallback,v=r.isElementPinnedToMasonryUpperRight,b=r.timelineObjectClassName;this.transformObjects=s,null==g||g(n);var f=[],x=t.reduce(((e,n,s)=>{null!=v&&v(n)&&f.push(s);var r=null==o?void 0:o.relatedPosts;if(n.parentPostId&&(null==r||!r[null==n?void 0:n.id]))return e;if(null!=r&&r[null==n?void 0:n.id]){var a=[...e],d=Object.values(r).find((e=>e.interactedPost===n.id));return r[n.id]&&!d&&a.push(this.renderElement(n,s)),r[n.id].elements.map(((e,n)=>{var i=t.find((t=>t.id===e.id));i&&a.push(this.renderElement(i,s+n+1))})),r[n.id].interactedPost&&a.push((0,O.jsx)("div",{className:te.Z.animateContainerIn,children:[...Object.values(r[n.id].posts).map((e=>{var o=t.find((t=>t.id===e.id)),a=r[n.id].interactedPost,d=r[n.id].prevInteractedPost,u=l()(b,{[te.Z.animateIn]:a===e.id,[te.Z.animateOut]:d===e.id,[te.Z.none]:e.id!==a&&e.id!==d});return this.renderElement(i()(i()(i()({},e),o),{},{className:u}),s)}))]},n.id)),a}return[...e,this.renderElement(n,s)]}),[]);if(a===J.mt.Masonry)return(0,O.jsx)(B,{masonryProps:i()({pinnedToUpperRightIndexes:f,children:x},h&&{columnWidth:h,elementSpacing:c}),maximumNumberOfColumns:u,masonryRendersWithSidebar:m});if(d){var P=(0,O.jsx)(q.Jj.Provider,{value:this.getQueueContext(t),children:x});return(0,O.jsx)(D.ZP,{children:e=>e.isMobile?P:(0,O.jsx)(U.Z,{fallback:null,children:(0,O.jsx)(p.Z,{className:"sortableContainer",options:{animation:150,onStart:this.onQueueSortStart,onEnd:this.onQueueSortEnd,draggable:".".concat(se.Z.sortDragDropTarget),handle:".".concat(ne.Z.reorderButton),forceFallback:!0},onChange:z.Z,children:P})})})}return(0,O.jsx)("div",{className:a===J.mt.Grid?te.Z.gridded:null,children:x})})),r()(this,"renderElement",((e,t)=>{var n=this.props,s=n.timelineObjectClassName,o=n.gridChildren,r=n.hoverContent,a=this.state.clientInnerHeight,d="".concat(e.placementId?"".concat(e.placementId,":"):"").concat(e.id).concat(e.isExpandedInGrid?":expanded":"");return(0,O.jsx)(H.ZP,{ref:e=>this.postRefs[t]=e,className:l()(s,e.className),presentationStyle:this.props.overridePresentationStyle,timelineObject:i()({},e),displayMode:this.props.displayMode,toggleExpandedInGrid:this.toggleExpandedInGrid,isInboxTimeline:this.props.isInboxTimeline,clientInnerHeight:a,gridChildren:o,hoverContent:r,index:t},d)})),r()(this,"getManualPaginatorButtonCSS",(()=>{var e=this.props,t=e.displayMode,n=e.manualPaginatorButtonCss,s=t===J.mt.Grid?te.Z.manualPaginatorButtonsGrid:null;return i()(i()({},n&&n),{},{containerClassName:s})})),r()(this,"apiQueueSort",((e,t)=>{var n=this.props.appContext.apiFetch,s=e.blogName,i=e.id,o=e.insertAfter,r=e.oldIndex;return s?(0,_.wW)(n,{blogName:s,id:i,insertAfter:o}).fetch().catch((()=>t(i,r))):(t(i,r),Promise.reject())})),r()(this,"onQueueSortStart",(()=>{this.setState({isSorting:!0})})),r()(this,"onQueueSortEnd",(e=>{this.setState({isSorting:!1});var t=this.getSortParameters(e);this.onQueueReorder(t.id,t.newIndex),this.apiQueueSort(i()({},t),this.onQueueReorder)})),r()(this,"onNoteStatusUpdated",((e,t)=>{this.transformObjects((n=>n.map((n=>{if(!(0,J.xT)(n)||n.id!==e)return n;var s=t(n);return this.maybeUpdateDockedPost(s),s}))))})),r()(this,"onReplyAdded",(e=>this.onNoteStatusUpdated(e,(e=>(0,ee.Js)(e))))),r()(this,"onReplyRemoved",(e=>this.onNoteStatusUpdated(e,(e=>(0,ee.RN)(e))))),r()(this,"onReblogged",(e=>this.onNoteStatusUpdated(e,(e=>(0,ee.ql)(e))))),r()(this,"onLike",((e,t)=>this.onNoteStatusUpdated(e,(e=>(0,ee.bX)(e,t))))),r()(this,"onNotesUpdate",((e,t)=>this.onNoteStatusUpdated(e,(e=>(0,ee.Pl)(e,t))))),r()(this,"onEdit",(e=>{this.transformObjects((t=>t.map((t=>(0,J.xT)(t)&&t.id===e.id?e:t))))})),r()(this,"onPin",((e,t)=>{this.transformObjects((n=>n.map((n=>(0,J.xT)(n)?n.id!==e?t&&n.isPinned?i()(i()({},n),{},{isPinned:!1}):n:i()(i()({},n),{},{isPinned:t}):n))))})),r()(this,"onFollow",(function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.transformObjects((s=>s.map((s=>{if((0,J.xT)(s)){var i=(0,ee.dQ)(s,t,n);return e.maybeUpdateDockedPost(i),i}return s}))))})),r()(this,"onPromote",((e,t)=>{this.transformObjects((n=>n.map((n=>{if((0,J.xT)(n)&&n.id===e){var s=(0,ee.ST)(n,t);return this.maybeUpdateDockedPost(s),s}return n}))))})),r()(this,"onQueueReorder",((e,t)=>{this.transformObjects((n=>{var s=n.find((t=>t.id===e));if(void 0===s)return n;var i=n.filter((e=>G.hA.Queued===e.state&&G.SH.Scheduled===e.queuedState)),o=n.filter((e=>G.hA.Queued===e.state&&G.SH.Queued===e.queuedState)),r=o.map(((e,t)=>e.scheduledPublishTime)),a=o.indexOf(s),l=[...o];return l.splice(t,0,l.splice(a,1)[0]),[...i,...l.map(((e,t)=>(e.scheduledPublishTime=r[t],e)))].sort(ie)}))})),r()(this,"onInjectTimelineObjects",((e,t)=>{this.transformObjects((n=>{var s=n.findIndex((t=>t.id===e));if(-1===s)return n;var i=[...n];return i.splice(s+1,0,...t),i}))})),r()(this,"onRemoveTimelineObject",(e=>{var t,n,s,i,o=e.id,r=e.wasBlogUnfollowed,a=this.props,l=a.isQueue,d=a.displayMode,u=a.doesNotRemoveUnfollowedObjects,h=a.postCountContext.refreshCounts;if(u&&r)return z.Z;if(d===J.mt.Grid){var c=(0,H.l9)();this.toggleExpandedInGrid({id:o,hasExpandedVersionBelowIt:!0},c)}this.transformObjects((e=>{n=[...e];var r=e.find((e=>e.id===o));if(void 0===r)return e;if(t=e.indexOf(r),i=(0,J.xT)(r),(s=[...e]).splice(t,1),i&&l&&r.state===G.hA.Queued&&r.queuedState===G.SH.Queued){var a=e.filter((e=>e.state===G.hA.Queued&&e.queuedState===G.SH.Queued)).map((e=>e.scheduledPublishTime)),d=s.filter((e=>e.state===G.hA.Queued&&e.queuedState===G.SH.Scheduled)),u=s.filter((e=>e.state===G.hA.Queued&&e.queuedState===G.SH.Queued));s=[...d,...u.map(((e,t)=>(e.scheduledPublishTime=a[t],e)))].sort(ie)}return e[t].animateOut=!0,e}));return setTimeout((()=>{this.transformObjects((e=>s)),h(),this.postRefs.pop()}),Y().postSlideOutDurationInMs),()=>this.transformObjects((()=>n))})),r()(this,"toggleExpandedInGrid",((e,t)=>{this.props.displayMode===J.mt.Grid&&this.transformObjects((n=>{var s=n.findIndex((t=>t.id===e.id));if(-1===s)return n;for(var o=0,r=0;r<n.length&&!(r>=s);r+=1){n[r].isExpandedInGrid&&(o+=1)}for(var a=t-(s+o*(t-1))%t,l=s+a,d=s-(t-a);d<l;d+=1){var u=i()({},n[d]);delete u.hasExpandedVersionBelowIt,n[d]=u}var h=n[l]&&n[l].isExpandedInGrid?l+1:l;if(e.hasExpandedVersionBelowIt)return[...n.slice(0,l),...n.slice(h,n.length)];var c=i()(i()({},structuredClone(e)),{},{isExpandedInGrid:!0}),p=[...n.slice(0,l),c,...n.slice(h,n.length)];return p[s]=i()(i()({},p[s]),{},{hasExpandedVersionBelowIt:!0}),p}))})),r()(this,"getPostRefs",(()=>this.postRefs))}componentDidMount(){var e,t;null===(e=(t=this.props.dockableContext).setTimelineContext)||void 0===e||e.call(t,this.getTimelineContextValue(this.props.displayMode)),this.setState({clientInnerHeight:window.innerHeight})}componentDidUpdate(e){if(e.displayMode!==this.props.displayMode){var t={[J.mt.Grid]:C.J.TimelineDisplayModeToggleGrid,[J.mt.List]:C.J.TimelineDisplayModeToggleList,[J.mt.Masonry]:C.J.TimelineDisplayModeToggleMasonry}[this.props.displayMode];this.props.appContext.logEvent({eventName:t})}}render(){var e=this.state.isSorting,t=this.props,n=t.debug,s=t.displayMode,o=t.onPagination,r=t.onPaginationError,a=t.hidesPullToRefresh,d=t.getNextLink,u=t.endpointApiRequest,h=t.getInitialPage,c=t.isObjectOmittedFromRender,p=t.getObjectsFromResponse,g=t.knightRiderLoaderColor,v=t.scrollContainer,b=t.emptyView,f=t.errorView,x=t.isQueue,P=t.prevButtonIsRefresh,C=t.getPrevLink,k=t.updateUrlFromCurrentPageLink,T=t.appContext.endlessScrollingDisabled,j={debug:n,endpointApiRequest:u,scrollContainer:v,errorView:f,onPagination:o,onPaginationError:r,getNextLink:d,getInitialPage:h,getObjectsFromResponse:p,isObjectOmittedFromRender:c,updateUrlFromCurrentPageLink:k,loader:this.getLoader(g),pullToRefresh:!a,lockScrollOnObjectUpdate:x,emptyView:b||this.getEmptyView(s)};return(0,O.jsx)(S.k.Provider,{value:this.getTimelineContextValue(this.props.displayMode),children:(0,O.jsx)(I,{children:(0,O.jsx)(y.G.Consumer,{children:t=>(0,O.jsx)("div",{className:l()(te.Z.timeline,{[te.Z.isSorting]:e,[te.Z.masonry]:s===J.mt.Masonry}),"data-timeline":null==u?void 0:u.getGivenPath(),"data-which":null==u?void 0:u.getWhichQueryParam(),children:(0,O.jsx)(K.I.Provider,{value:v&&(0,W.Re)(v)?v:null,children:(0,O.jsx)(m.ZP,{disabled:[J.mt.Grid,J.mt.Masonry].includes(s),getPostRefs:this.getPostRefs,children:T?(0,O.jsx)(A.ZP,i()(i()({},j),{},{getPrevLink:C,prevButtonIsRefresh:P,manualPaginatorButtonCss:this.getManualPaginatorButtonCSS(),children:e=>this.renderTimelineElements(i()(i()({},e),{},{relatedPostsContext:t}))})):(0,O.jsx)(L.ZP,i()(i()({},j),{},{fetchDistance:1600,children:e=>this.renderTimelineElements(i()(i()({},e),{},{relatedPostsContext:t}))}))})})})})})})}getQueueContext(e){return{allPosts:e.map((e=>e.id)),queuedPosts:e.filter((e=>G.hA.Queued===e.state&&G.SH.Queued===e.queuedState)).map((e=>e.id))}}getSortParameters(e){var t,n=e.item.dataset.id,s=0,i=-1,o=-1;return this.transformObjects((r=>{var a=r.filter((e=>G.hA.Queued===e.state&&G.SH.Queued===e.queuedState)).map((e=>e.id)),l=r.find((e=>e.id===n));return t=null==l?void 0:l.blogName,o=a.findIndex((t=>r[e.oldIndex].id===t)),i=a.findIndex((t=>r[e.newIndex].id===t)),s=r[e.newIndex-1]&&r[e.newIndex-1].id||0,r})),{blogName:t,id:n,insertAfter:s,oldIndex:o,newIndex:i}}maybeUpdateDockedPost(e){var t=this.props.dockableContext,n=t.isMediaDocked,s=t.dockedTimelineObject,i=t.setDockedTimelineObject;n&&e.id===(null==s?void 0:s.id)&&i(e)}}r()(oe,"defaultProps",{hidesPullToRefresh:!1,displayMode:J.mt.List,errorView:null,getNextLink:e=>{var t,n,s;return null==e||null===(t=e.response)||void 0===t||null===(n=t.timeline)||void 0===n||null===(s=n.links)||void 0===s?void 0:s.next}});var re=(0,X.X9)(oe,{appContext:!0,postCountContext:!0,dockableContext:!0,relatedPostsContext:!0,timelineContext:!0});class ae extends c.Component{render(){return(0,O.jsx)(re,i()({},this.props))}}r()(ae,"defaultProps",oe.defaultProps);const le=ae},87224:(e,t,n)=>{n.d(t,{u:()=>p});var s=n(54138),i=n.n(s),o=n(50209),r=n.n(o),a=n(95004),l=n(10381),d=n(18599),u=n(78667),h=n(2629);class c extends a.Component{constructor(){super(...arguments),r()(this,"state",{matchedBreakpoint:void 0})}static getDerivedStateFromProps(e,t){var n=((e,t)=>[...t].reverse().find((t=>t<=e)))(e.width,e.breakpoints);return n===t.matchedBreakpoint?null:{matchedBreakpoint:n}}shouldComponentUpdate(e,t){return t.matchedBreakpoint!==this.state.matchedBreakpoint||this.props.children!==e.children}render(){return this.props.children(this.props.width)}}function p(e){var t=(0,u.bp)().getBrowserInfo,n=(0,d.AJ)(t());return e.width?(0,h.jsx)(c,i()({},e)):(0,h.jsx)(l.U$,{children:t=>{var s=t.width,o=t.bodyWidth;return(0,h.jsx)(c,i()(i()({},e),{},{width:n?o:s}))}})}},48385:(e,t,n)=>{n.d(t,{Fe:()=>r,XJ:()=>l,e$:()=>u,vk:()=>d});var s=n(96467),i=n.n(s),o=i().timelineMasonryPostWidth+i().timelineMasonryPostSpacing,r=[2*o,3*o,4*o],a=i().sidebarWidth+i().sidebarMargin,l=r.map((e=>e+a)),d=(e,t)=>h(e,!!t),u=e=>h(e,!0),h=(e,t)=>Math.min(2+r.length-1,Math.max(Math.floor((e-(t?a:0))/o),1))}}]);